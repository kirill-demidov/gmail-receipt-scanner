{% extends "base.html" %}

{% block title %}–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Gmail - Receipt Scanner{% endblock %}

{% block content %}
<div class="card">
    <h2>üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Gmail</h2>
    
    {% if status.is_scanning %}
        <div class="scanning-status">
            <h3>‚è≥ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...</h3>
            <div class="progress-info">
                <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="progress-text">{{ status.progress }}</span></p>
                <p><strong>–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ø–∏—Å–µ–º:</strong> <span id="emails-processed">{{ status.emails_processed }}</span></p>
                <p><strong>–ù–∞–π–¥–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:</strong> <span id="documents-found">{{ status.documents_found }}</span></p>
            </div>
            
            <div style="margin-top: 1rem;">
                <div style="background: #f0f0f0; height: 10px; border-radius: 5px; overflow: hidden;">
                    <div class="progress-bar" style="background: #3498db; height: 100%; width: 50%; transition: width 0.3s;"></div>
                </div>
            </div>
            
            <p style="margin-top: 1rem; color: #666; font-size: 0.9rem;">
                –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–æ –≤—Ä–µ–º—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
            </p>
        </div>
    {% else %}
        <div class="scan-form">
            <p>–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Gmail –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–æ–≤—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.</p>
            
            <form action="/start_scan" method="POST" style="margin-top: 1.5rem;">
                <div style="margin-bottom: 1rem;">
                    <label for="days" style="display: block; margin-bottom: 0.5rem; font-weight: bold;">
                        –ì–ª—É–±–∏–Ω–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
                    </label>
                    <select name="days" id="days" style="width: 200px; padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem;">
                        <option value="1">–ü–æ—Å–ª–µ–¥–Ω–∏–π 1 –¥–µ–Ω—å</option>
                        <option value="3">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –¥–Ω—è</option>
                        <option value="7">–ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–µ–¥–µ–ª—è</option>
                        <option value="14">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 2 –Ω–µ–¥–µ–ª–∏</option>
                        <option value="30" selected>–ü–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü</option>
                        <option value="60">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 2 –º–µ—Å—è—Ü–∞</option>
                        <option value="90">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞</option>
                        <option value="180">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤</option>
                        <option value="365">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥</option>
                    </select>
                </div>
                
                <button type="submit" class="btn" style="background: #27ae60; font-size: 1.1rem; padding: 1rem 2rem;">
                    üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                </button>
            </form>
        </div>
    {% endif %}
</div>

<div class="card">
    <h3>üìä –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏?</h3>
    <ol>
        <li><strong>–ü–æ–∏—Å–∫ –ø–∏—Å–µ–º</strong> - —Å–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç –≤—Å–µ –ø–∏—Å—å–º–∞ —Å –≤–ª–æ–∂–µ–Ω–∏—è–º–∏ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</li>
        <li><strong>–ê–Ω–∞–ª–∏–∑ –≤–ª–æ–∂–µ–Ω–∏–π</strong> - –ø—Ä–æ–≤–µ—Ä–∫–∞ PDF, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ</li>
        <li><strong>–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ –ø–∏—Å–µ–º</strong> - –ø–æ–∏—Å–∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏ —Å—Å—ã–ª–æ–∫ –≤ —Ç–µ–∫—Å—Ç–µ —Å–∞–º–∏—Ö –ø–∏—Å–µ–º</li>
        <li><strong>OCR –æ–±—Ä–∞–±–æ—Ç–∫–∞</strong> - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º, –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –∏ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö</li>
        <li><strong>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</strong> - –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</li>
    </ol>
    
    <div style="margin-top: 1rem; padding: 1rem; background: #e8f5e8; border-radius: 5px; font-size: 0.9rem;">
        <strong>üí° –°–æ–≤–µ—Ç:</strong> –î–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–±—Ä–∞—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π –ø–µ—Ä–∏–æ–¥ (1-7 –¥–Ω–µ–π) 
        —á—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É, –∞ –∑–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞ –±–æ–ª—å—à–∏–π –ø–µ—Ä–∏–æ–¥.
    </div>
</div>

{% if not status.is_scanning %}
<script>
// Automatically refresh page when scanning starts
document.querySelector('form').addEventListener('submit', function() {
    setTimeout(function() {
        window.location.reload();
    }, 2000);
});
</script>
{% else %}
<script>
// Auto-update scanning status
function updateStatus() {
    fetch('/api/scan_status')
        .then(response => response.json())
        .then(data => {
            document.getElementById('progress-text').textContent = data.progress;
            document.getElementById('emails-processed').textContent = data.emails_processed;
            document.getElementById('documents-found').textContent = data.documents_found;
            
            if (!data.is_scanning) {
                setTimeout(function() {
                    window.location.reload();
                }, 3000);
            }
        })
        .catch(error => console.error('Error:', error));
}

// Update every 3 seconds
setInterval(updateStatus, 3000);
</script>
{% endif %}
{% endblock %}