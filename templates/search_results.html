{% extends "base.html" %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ - Receipt Scanner{% endblock %}

{% block content %}
<div class="card">
    <h2>üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞: "{{ query }}"</h2>
    
    <form action="/search" method="GET" style="margin-bottom: 1rem;">
        <input type="text" name="q" class="search-box" 
               placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å..."
               value="{{ query }}"
               autofocus>
        <button type="submit" class="btn">–ù–∞–π—Ç–∏</button>
    </form>
    
    {% if documents %}
        <p><strong>–ù–∞–π–¥–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: {{ documents|length }}</strong></p>
        
        {% for doc in documents %}
        <div class="document-item">
            <div class="document-title">
                {% if doc.document_type == 'email_content' %}
                    üìß {{ doc.subject[:60] }}{% if doc.subject|length > 60 %}...{% endif %}
                {% else %}
                    üìÅ {{ doc.filename }}
                {% endif %}
            </div>
            <div class="document-meta">
                üìß <strong>–û—Ç:</strong> {{ doc.sender }}<br>
                üìÖ <strong>–î–∞—Ç–∞:</strong> {{ doc.email_date }}<br>
                üè∑Ô∏è <strong>–¢–µ–º–∞:</strong> {{ doc.subject }}<br>
                üìë <strong>–¢–∏–ø:</strong> {{ '–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∏—Å—å–º–∞' if doc.document_type == 'email_content' else '–í–ª–æ–∂–µ–Ω–∏–µ' }}<br>
                üåê <strong>–Ø–∑—ã–∫:</strong> {{ doc.language }}<br>
                üî¢ <strong>–û—Ü–µ–Ω–∫–∞:</strong> {{ doc.financial_score }}/100<br>
                {% if doc.gmail_url %}
                    üîó <strong>Gmail:</strong> <a href="{{ doc.gmail_url }}" target="_blank" style="color: #3498db;">–û—Ç–∫—Ä—ã—Ç—å –ø–∏—Å—å–º–æ</a>
                {% endif %}
            </div>
            
            {% if doc.amounts_found %}
            <div class="document-amounts">
                üí∞ <strong>–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å—É–º–º—ã:</strong> {{ doc.amounts_found|join(', ') }}
            </div>
            {% endif %}
            
            {% if doc.keywords_found %}
            <div class="document-keywords">
                üî§ <strong>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</strong> {{ doc.keywords_found|join(', ') }}
            </div>
            {% endif %}
            
            {% if doc.text_content %}
            <details style="margin-top: 0.5rem;">
                <summary style="cursor: pointer; color: #3498db;">üìù –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞</summary>
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 5px; margin-top: 0.5rem; font-family: monospace; font-size: 0.9rem; max-height: 200px; overflow-y: auto;">
                    {{ doc.text_content }}
                </div>
            </details>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <div style="text-align: center; padding: 2rem;">
            <p>üì≠ –ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ query }}" –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:</p>
            <ul style="text-align: left; display: inline-block;">
                <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</li>
                <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è</li>
                <li>–ò—Å–∫–∞—Ç—å –ø–æ —á–∞—Å—Ç–∏ —Å–ª–æ–≤–∞</li>
                <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –æ–±—â–∏–µ —Ç–µ—Ä–º–∏–Ω—ã</li>
            </ul>
        </div>
    {% endif %}
</div>

<div class="card">
    <p><a href="/search" class="btn">‚Üê –ù–æ–≤—ã–π –ø–æ–∏—Å–∫</a> <a href="/documents" class="btn">–í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</a></p>
</div>
{% endblock %}