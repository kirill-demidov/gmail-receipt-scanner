{% extends "base.html" %}

{% block title %}Receipt Scanner - –ì–ª–∞–≤–Ω–∞—è{% endblock %}

{% block content %}
<div class="card">
    <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
    <div class="stats">
        <div class="stat-item">
            <span class="stat-number">{{ stats.total_documents or 0 }}</span>
            <span>–ù–∞–π–¥–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">{{ stats.by_language|length or 0 }}</span>
            <span>–Ø–∑—ã–∫–æ–≤ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">{{ stats.recent_scans or 0 }}</span>
            <span>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∑–∞ –Ω–µ–¥–µ–ª—é</span>
        </div>
    </div>
    
    {% if stats.by_language %}
    <h3>–ü–æ —è–∑—ã–∫–∞–º:</h3>
    <ul>
        {% for lang, count in stats.by_language.items() %}
        <li><strong>{{ lang }}</strong>: {{ count }} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>

<div class="card">
    <h2>üÜï –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</h2>
    
    {% if documents %}
        {% for doc in documents %}
        <div class="document-item">
            <div class="document-title">
                {% if doc.document_type == 'email_content' %}
                    üìß {{ doc.subject[:60] }}{% if doc.subject|length > 60 %}...{% endif %}
                {% else %}
                    üìÅ {{ doc.filename }}
                {% endif %}
            </div>
            <div class="document-meta">
                üìß –û—Ç: {{ doc.sender }}<br>
                üìÖ –î–∞—Ç–∞: {{ doc.email_date }}<br>
                üè∑Ô∏è –¢–µ–º–∞: {{ doc.subject[:80] }}{% if doc.subject|length > 80 %}...{% endif %}<br>
                üìë –¢–∏–ø: {{ '–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∏—Å—å–º–∞' if doc.document_type == 'email_content' else '–í–ª–æ–∂–µ–Ω–∏–µ' }}<br>
                üî¢ –û—Ü–µ–Ω–∫–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ—Å—Ç–∏: {{ doc.financial_score }}/100<br>
                {% if doc.gmail_url %}
                    üîó <a href="{{ doc.gmail_url }}" target="_blank" style="color: #3498db;">–û—Ç–∫—Ä—ã—Ç—å –≤ Gmail</a>
                {% endif %}
            </div>
            
            {% if doc.amounts_found %}
            <div class="document-amounts">
                üí∞ –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å—É–º–º—ã: {{ doc.amounts_found|join(', ') }}
            </div>
            {% endif %}
            
            {% if doc.keywords_found %}
            <div class="document-keywords">
                üî§ –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: {{ doc.keywords_found|join(', ') }}
            </div>
            {% endif %}
        </div>
        {% endfor %}
        
        <p>
            <a href="/documents" class="btn">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã ‚Üí</a>
            <a href="/scan" class="btn" style="background: #27ae60; margin-left: 1rem;">üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
        </p>
    {% else %}
        <div style="text-align: center; padding: 2rem;">
            <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">
                –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Gmail!
            </p>
            <p>
                <a href="/scan" class="btn" style="background: #27ae60; font-size: 1.2rem; padding: 1rem 2rem;">
                    üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                </a>
            </p>
        </div>
    {% endif %}
</div>

<div class="card">
    <h2>üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</h2>
    <ol>
        <li><strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Gmail API:</strong>
            <pre><code>cd src && python main.py init</code></pre>
        </li>
        <li><strong>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—á—Ç—ã:</strong>
            <pre><code>python main.py scan</code></pre>
        </li>
        <li><strong>–ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</strong>
            <pre><code>python main.py show</code></pre>
        </li>
        <li><strong>–ü–æ–∏—Å–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:</strong>
            <pre><code>python main.py search "–±–∞–Ω–∫"</code></pre>
        </li>
    </ol>
    
    <p><strong>–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:</strong></p>
    <pre><code>python web_app.py</code></pre>
</div>
{% endblock %}